# 인증 서비스

로그인이 필요한 이유 : http는 stateless

### Stateless

각 요청은 개별적으로 인식됨, 성능적인 문제로 인해 요청안에 State와 info를 넣지 못함

## 인증 및 인사 절차 기본 흐름

1. 유저가 서버에 요청 전송
2. 서버는 유저정보를 포함하는 토큰 생성
3. 클라이언트에 토큰 전송
4. 클라이언트에서 토큰 저장
5. 유저가 토큰과 함께 요청 전송(Stateful)
6. 서버가 토큰을 복호화해서 유저임을 인식

## JWT란?

당사자간에 정보를 JSON 객체로 안전하게 전송하기 위한 개방형 표준

### JWT의 구조

- Header: 토큰에 대한 메타 데이터 포함
- Payload: 유저 정보, 만료 기간 등의 정보(DATA)
- Verify Signature: 토큰이 보낸 사람에 의해 서명되었으며 어떤 식으로든 변경되지 않았는지 확인하는 데 사용되는 서명. 헤더 및 페이로드 세그먼트, 서명 알고리즘, 비밀 또는 공개 키를 사용하여 생성됨

### 사용 흐름

유저 로그인 -> 토큰 생성 -> 토큰 보관(클라이언트)
서버에서는 시그니처 부분을 비교하여 올바른 토큰인지 검증하는 작업을 진행함

## RefreshToken

토큰의 유효시간을 너무 길게 하면, 토큰 탈취시 위험이 증가
토큰의 유효시간을 너무 짧게 하면, 자주 로그인해야해서 번거로움 -> 사용성 저하

### 로그인 전체 과정

1. 사용자가 로그인 시도

- 서버에서는 로그인 회원을 DB에서 찾아봄, 비밀번호가 맞는지도 확인함

2. 로그인이 완료되면 Access Token과 함께 Refresh Token이 발급됨. 회원 DB에 일반적으로 Refresh Token을 저장함

3. 사용자가 Refresh Token을 안전한 장소에 보관한 후, 서버에 요청을 보낼 때 Access Token을 헤더에 실어 요청을 보냄

4. Access Token을 서버에서 검증하게되며 맞는 Token이라면 요청한 데이터를 보내줌

5. Access Token의 유효기간이 만료되었을 때 요청을 보냄

6. Access Token의 유효기간이 만료되었기 때문에 권한 없음 에러를 보냄

7. 사용자는 Refresh Token을 서버로 보내며 Access Token 발급 요청을 함

8. 서버에서는 사용자가 보낸 Refresh Token과 DB에 저장되어 있는 Refresh Token을 비교함
   Refresh Token이 동일하고 유효기간도 지나지 않았다면 Access Token을 새로 발급함
